 <html>
	<head>
		<script>
				let canvas, ctx, flag = false, prevX = 0, currX = 0, prevY = 0, currY = 0, ws;
				let new_lines = [];
                let count = 0;
				
                const decoder = new TextDecoder();
                
				function main() {
					/* Connect to the server */
					ws = new WebSocket('ws://localhost:9001');
					ws.binaryType = 'arraybuffer';
		
					ws.onopen = () => {
						/* Join the "room" of canvas 1 */
					};
		
					/* For every message we receive */
					ws.onmessage = (message) => {
                        //console.log("MSG DATA", message);
                        console.log("MESSAGE", message);
                        msgObj = JSON.parse(message.data);
                        //console.log("MSG OBJ", msgObj);
                        //console.log("MSG OBJ0", msgObj[0]);
                        switch (msgObj[0]) {
						/* Request a new animation frame on first draw */
                        case "drawing":
                            if (new_lines.length == 0) {
                                window.requestAnimationFrame(() => {
                                    //console.log(new_lines.length);
            
                                    new_lines.forEach((li) => {
                                        ctx.beginPath();
                                    
                                        if (li.length == 5) {
                                        ctx.arc(li[0], li[1], li[2], li[3], li[4]);
                                        } 
                                        else {
                                        ctx.moveTo(li[0], li[1]);
                                        //console.log(li[0], li[1]);
                                        var length = li.length - 2;
                                        
                                        var x = 2;
                                        var y = 3;
                                            while (length >= 0) {
                                            ctx.lineTo(li[x], li[y]);
                                            console.log(li[x], li[y]);
                                            length = length - 2;
                                            x += 2;
                                            y += 2;
                                            };
                                        }
                                            
                                        ctx.stroke();
                                        count++;
                                        //console.log(count);
                                        //console.log("STROKED");
                                        });
                                    new_lines = [];
                                    });
            
                                    
                                
                                    
                                }
                            /* Add this draw to the pending buffer */
                            f = new Uint16Array(Object.values(msgObj[1]));
                            //console.log("AA", f);
                            new_lines.push(f);
                            //console.log("added");
                            break;
                        case "scoreboard":
                            console.log('inside scoreboard');
                            d = function(){
                                var ul = document.createElement('ul');
                                ul.setAttribute('id','proList');

                                var t, tt;
                                productList = (Object.entries(msgObj[1]));

                                function removeAllChildNodes(parent) {
                                    while (parent.firstChild) {
                                        parent.removeChild(parent.firstChild);
                                    }
                                }
                                removeAllChildNodes(document.getElementById('renderList'));
                                document.getElementById('renderList').appendChild(ul);
                                productList.forEach(renderProductList);

                                function renderProductList(element, index, arr) {
                                    var li = document.createElement('li');
                                    li.setAttribute('class','item');
                                    
                                    ul.appendChild(li);
                                    
                                    t = document.createTextNode(element);
                                    
                                    li.innerHTML=li.innerHTML + element;
                                }
                            };
                            d();
                            console.log('CALLED');
                            break;
                        case "GAME START":
                            num = 3;  
                            ctx.font = "120px Verdana";
                            ctx.strokeText(num.toString(),320,200);
                            num--;
                            var x = setInterval(function() {
                                if (num == 0) {
                                    clearInterval(x);
                                    return;
                                }
                                ctx.font = "120px Verdana";
                                ctx.strokeText(num.toString(),320,200);
                                // Output the result in an element with id="demo"
                                num--;
                                // If the count down is over, write some text 
                            }, 1000);
                            break;
                            
                        case "GAME OVER":
                            document.getElementById("countdown").innerHTML = msgObj[1] + " WINS";
                            var node = document.createElement("LI");
                            break;
                        }
					};
		
					canvas = document.getElementById('can');
					ctx = canvas.getContext("2d");
					w = canvas.width;
					h = canvas.height;
		
					ctx.strokeStyle = 'black';
					ctx.lineWidth = 1;
				
					canvas.addEventListener("mousemove", function (e) {
						if (flag) {
							prevX = currX;
							prevY = currY;
							currX = e.clientX / window.innerWidth * 720;
							currY = e.clientY / window.innerHeight * 480;
							
							/* Send to the server how we drew */
							ws.send(Uint16Array.of(prevX, prevY, currX, currY));
						}
					}, false);
		
					canvas.addEventListener("mousedown", function (e) {
						currX = e.clientX / window.innerWidth * 720;
						currY = e.clientY / window.innerHeight * 480;
						flag = true;
					}, false);
		
					canvas.addEventListener("mouseup", function (e) {
						flag = false;
					}, false);
		
					canvas.addEventListener("mouseout", function (e) {
						flag = false;
					}, false);
                    
                    function fadeOut() {
                    ctx.fillStyle = "rgba(255,255,255,0.3)";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    setTimeout(fadeOut,100);
                    }

                    fadeOut();
                    
                    const input = document.querySelector('input');
                    input.addEventListener("keyup", updateValue);

                    function updateValue(e) {
                      if (e.keyCode == 13) {
                        ws.send(e.target.value);
                        e.target.value = '';
                      }
                      
                    }
                    
                    const playButton = document.querySelector('button');
                    playButton.addEventListener("click", requestGame);
                    
                    function requestGame(e) {
                        console.log("button");
                        ws.send('play');
                      }
                      
                    const backButton = document.getElementsByTagName('button')[1];
                    backButton.addEventListener("click", backAction);
                    
                    function backAction(e) {
                        function removeAllChildNodes(parent) {
                            while (parent.firstChild) {
                                parent.removeChild(parent.firstChild);
                            }
                        }
                        removeAllChildNodes(document.getElementById('renderList'));
                        document.getElementById("countdown").innerHTML = "";
                      }
                    
				}
			</script>
	</head>
    <body onload="main()" style="margin: 0; height: 100vh; width: 100vw">
        <p id="countdown" style='position:fixed;top:50%;left:50%;transform: translate(-50%, -50%);'></p>
        <div id="renderList" style="position:fixed;top:10%;left:50%; height:10%; width: 20%;"></div>
        <button>Play</button>
        <button>Back</button>
        <canvas id="can" width="720" height="480" style="height: 100%; width: 100%"></canvas>
        <input style='position:fixed;top:90%;left:50%;transform: translate(-50%, -50%);' placeholder="Enter some text" name="name"/>
    </body>
</html>
